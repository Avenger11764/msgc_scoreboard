<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MSGC 3.0 Dual Tournament Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827;
            color: #F9FAFB;
        }
        .font-orbitron {
            font-family: 'Orbitron', sans-serif;
        }
        .tab-button.active {
            background-color: #3B82F6;
            color: white;
        }
        .neon-title {
            font-family: 'Orbitron', sans-serif;
            font-weight: 900;
            color: #fff;
            text-shadow:
                0 0 7px rgba(255, 255, 255, 0.8),
                0 0 10px rgba(59, 130, 246, 0.7),
                0 0 21px rgba(59, 130, 246, 0.6);
        }
        .table-container {
            background-color: rgba(17, 24, 39, 0.8);
            border: 1px solid #374151;
            border-radius: 0.5rem;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.1);
        }
        .table-header {
            background: linear-gradient(90deg, rgba(59, 130, 246, 0.2), rgba(139, 92, 246, 0.2));
        }
        .table-row-hover:hover {
            background-color: rgba(59, 130, 246, 0.1);
        }
        .btn-primary {
            background: linear-gradient(90deg, #3B82F6, #8B5CF6);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        /* Rank Colors */
        .rank-1 { color: #FFD700; text-shadow: 0 0 4px #FFD700; }
        .rank-2 { color: #C0C0C0; text-shadow: 0 0 4px #C0C0C0; }
        .rank-3 { color: #CD7F32; text-shadow: 0 0 4px #CD7F32; }
    </style>
</head>
<body class="text-gray-300">

    <div class="container mx-auto p-4 md:p-8">
        <h1 class="text-5xl text-white text-center mb-4 neon-title">MSGC 3.0 Tournament</h1>
        <p class="text-center text-gray-400 mb-8">A two-phase tournament: Teams and Individuals.</p>

        <!-- Tabs -->
        <div class="mb-8 border-b border-gray-700 flex justify-center">
            <button class="tab-button text-lg font-semibold py-3 px-6 text-gray-400 hover:text-white transition-colors active" data-tab="team-standings">Team Standings</button>
            <button class="tab-button text-lg font-semibold py-3 px-6 text-gray-400 hover:text-white transition-colors" data-tab="individual-standings">Individual Standings</button>
            <button class="tab-button text-lg font-semibold py-3 px-6 text-gray-400 hover:text-white transition-colors flex items-center gap-2" data-tab="admin-panel">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-lock-fill" viewBox="0 0 16 16">
                    <path d="M8 1a2 2 0 0 1 2 2v4H6V3a2 2 0 0 1 2-2zm3 6V3a3 3 0 0 0-6 0v4a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2z"/>
                </svg>
                Admin Panel
            </button>
        </div>

        <!-- Content Panels -->
        <div id="content-panels">
            <!-- Team Standings Section -->
            <section id="team-standings" class="tab-content">
                 <h2 class="text-3xl font-bold text-white text-center mb-6 font-orbitron">Team Standings</h2>
                <div class="max-w-4xl mx-auto p-4 table-container">
                    <table class="w-full text-left">
                        <thead class="table-header">
                            <tr class="border-b border-gray-700">
                                <th class="p-4 rounded-tl-lg">Rank</th>
                                <th class="p-4">Team</th>
                                <th class="p-4 font-bold rounded-tr-lg">Score</th>
                            </tr>
                        </thead>
                        <tbody id="team-standings-body">
                            <!-- Rows will be generated here by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Individual Standings Section -->
            <section id="individual-standings" class="tab-content hidden">
                <h2 class="text-3xl font-bold text-white text-center mb-6 font-orbitron">Individual Standings</h2>
                <div class="max-w-4xl mx-auto p-4 table-container">
                    <table class="w-full text-left">
                        <thead class="table-header">
                            <tr class="border-b border-gray-700">
                                <th class="p-4 rounded-tl-lg">Rank</th>
                                <th class="p-4">Player</th>
                                <th class="p-4 font-bold rounded-tr-lg">Score</th>
                            </tr>
                        </thead>
                        <tbody id="individual-standings-body">
                            <!-- Rows will be generated here by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Admin Panel Section -->
            <section id="admin-panel" class="tab-content hidden">
                <div class="max-w-4xl mx-auto bg-gray-800 p-6 rounded-lg border border-gray-700">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-white font-orbitron">Admin Panel</h2>
                        <button id="reset-button" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg text-sm transition-colors">Reset Tournament</button>
                    </div>
                    
                    <!-- Participant Management -->
                    <div id="participant-management"></div>

                    <hr class="border-gray-600 my-8">

                    <!-- Score Updaters -->
                    <h3 class="text-xl font-bold text-white border-b border-gray-600 pb-2 mb-4 font-orbitron">Team Score Updater</h3>
                    <div id="team-admin-forms" class="space-y-6 mb-8"></div>

                    <h3 class="text-xl font-bold text-white border-b border-gray-600 pb-2 mb-4 mt-10 font-orbitron">Individual Score Updater</h3>
                    <div id="individual-admin-forms" class="space-y-6"></div>

                    <button id="update-button" class="mt-8 w-full btn-primary text-white font-bold py-3 px-6 rounded-lg">
                        Update All Scores
                    </button>
                    <div id="save-confirm" class="text-center mt-4 text-green-400 opacity-0 transition-opacity">Data Saved!</div>
                </div>
            </section>
        </div>
    </div>

    <!-- Password Modal -->
    <div id="password-modal" class="fixed inset-0 bg-gray-900/80 backdrop-blur-sm flex items-center justify-center hidden z-50">
        <div class="bg-gray-800 rounded-lg p-8 shadow-xl w-full max-w-sm">
            <h3 class="text-xl font-bold text-white mb-4">Admin Access Required</h3>
            <p class="text-gray-400 mb-6">Please enter the password to access the admin panel.</p>
            <input type="password" id="password-input" class="w-full bg-gray-700 rounded p-3 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500">
            <p id="password-error" class="text-red-400 text-sm mt-2 hidden">Incorrect password. Please try again.</p>
            <div class="mt-6 flex justify-end gap-4">
                <button id="password-cancel" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg transition-colors">Cancel</button>
                <button id="password-submit" class="btn-primary text-white font-bold py-2 px-4 rounded-lg">Submit</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // ===================================================================================
        // ===== PASTE YOUR FIREBASE CONFIG HERE ===========================================
        // ===================================================================================
        const firebaseConfig = {
  apiKey: "AIzaSyBQcjoCkbKljPFDsXrJcA12-Xym4G4Ntts",
  authDomain: "msgc3-scoreboard.firebaseapp.com",
  projectId: "msgc3-scoreboard",
  storageBucket: "msgc3-scoreboard.firebasestorage.app",
  messagingSenderId: "1027426979843",
  appId: "1:1027426979843:web:caadeb0a8204a987017e36",
  measurementId: "G-PV2EKKDN7K"
};
        // ===================================================================================

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const tournamentDocRef = doc(db, "tournamentData", "main");

        const ADMIN_PASSWORD = "msgc_admin_2025";

        const initialTournamentData = {
            teamTournament: { standings: [] },
            individualTournament: { standings: [] }
        };

        let tournamentData;
        let isAdminAuthenticated = false;

        const contentPanels = {
            'team-standings': document.getElementById('team-standings'),
            'individual-standings': document.getElementById('individual-standings'),
            'admin-panel': document.getElementById('admin-panel')
        };
        const teamStandingsBody = document.getElementById('team-standings-body');
        const individualStandingsBody = document.getElementById('individual-standings-body');
        const participantManagementContainer = document.getElementById('participant-management');
        const adminForms = {
            team: document.getElementById('team-admin-forms'),
            individual: document.getElementById('individual-admin-forms')
        };
        const updateButton = document.getElementById('update-button');
        const resetButton = document.getElementById('reset-button');
        const saveConfirm = document.getElementById('save-confirm');
        const tabButtons = document.querySelectorAll('.tab-button');
        const passwordModal = document.getElementById('password-modal');
        const passwordInput = document.getElementById('password-input');
        const passwordError = document.getElementById('password-error');
        const passwordSubmit = document.getElementById('password-submit');
        const passwordCancel = document.getElementById('password-cancel');

        function getRankHTML(rank) {
            let rankClass = "";
            if (rank === 1) rankClass = "rank-1";
            if (rank === 2) rankClass = "rank-2";
            if (rank === 3) rankClass = "rank-3";
            return `<span class="font-bold text-xl ${rankClass}">${rank}</span>`;
        }

        function renderAll() {
            if (!tournamentData) return;
            renderStandings('team');
            renderStandings('individual');
            renderAdminPanel();
        }

        function renderStandings(type) {
            const body = type === 'team' ? teamStandingsBody : individualStandingsBody;
            const standings = [...tournamentData[`${type}Tournament`].standings].sort((a, b) => b.score - a.score);
            body.innerHTML = '';
            standings.forEach((stat, index) => {
                const rank = index + 1;
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-800 last:border-b-0 table-row-hover';
                const name = type === 'team' ? stat.name : stat.player;
                row.innerHTML = `<td class="p-4 w-16 text-center">${getRankHTML(rank)}</td><td class="p-4 text-lg font-bold text-white">${name}</td><td class="p-4 text-lg font-extrabold text-blue-400">${stat.score}</td>`;
                body.appendChild(row);
            });
        }
        
        function renderAdminPanel() {
            renderParticipantManagement();
            renderScoreUpdater('team');
            renderScoreUpdater('individual');
        }

        function renderParticipantManagement() {
            participantManagementContainer.innerHTML = `
                <h3 class="text-xl font-bold text-white border-b border-gray-600 pb-2 mb-4 font-orbitron">Manage Participants</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div>
                        <h4 class="text-lg font-semibold text-white mb-3">Players</h4>
                        <div class="flex gap-2 mb-4">
                            <input type="text" id="new-player-name" placeholder="New Player Name" class="w-full bg-gray-700 rounded p-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <button id="add-player-btn" class="btn-primary text-white font-bold py-2 px-4 rounded-lg">Add</button>
                        </div>
                        <ul id="player-list" class="space-y-2"></ul>
                    </div>
                    <div>
                        <h4 class="text-lg font-semibold text-white mb-3">Teams</h4>
                        <div class="flex gap-2 mb-4">
                            <input type="text" id="new-team-name" placeholder="New Team Name" class="w-full bg-gray-700 rounded p-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <button id="add-team-btn" class="btn-primary text-white font-bold py-2 px-4 rounded-lg">Add</button>
                        </div>
                        <ul id="team-list" class="space-y-2"></ul>
                    </div>
                </div>
            `;
            
            const playerList = document.getElementById('player-list');
            tournamentData.individualTournament.standings.forEach(p => {
                playerList.innerHTML += `<li class="flex justify-between items-center bg-gray-700 p-2 rounded"><span>${p.player}</span><button class="remove-player-btn text-red-400 hover:text-red-300" data-player="${p.player}">Remove</button></li>`;
            });

            const teamList = document.getElementById('team-list');
            tournamentData.teamTournament.standings.forEach(t => {
                teamList.innerHTML += `<li class="flex justify-between items-center bg-gray-700 p-2 rounded"><span>${t.name}</span><button class="remove-team-btn text-red-400 hover:text-red-300" data-team="${t.name}">Remove</button></li>`;
            });

            document.getElementById('add-player-btn').addEventListener('click', addPlayer);
            document.getElementById('add-team-btn').addEventListener('click', addTeam);
            document.querySelectorAll('.remove-player-btn').forEach(btn => btn.addEventListener('click', (e) => removeParticipant('individual', e.target.dataset.player)));
            document.querySelectorAll('.remove-team-btn').forEach(btn => btn.addEventListener('click', (e) => removeParticipant('team', e.target.dataset.team)));
        }

        function renderScoreUpdater(type) {
            const formContainer = adminForms[type];
            const standings = tournamentData[`${type}Tournament`].standings;
            formContainer.innerHTML = '';
            standings.forEach((stat, index) => {
                const name = type === 'team' ? stat.name : stat.player;
                const formDiv = document.createElement('div');
                formDiv.className = "grid grid-cols-2 items-center gap-4";
                formDiv.innerHTML = `<div class="text-lg font-semibold text-white">${name}</div><div class="text-center"><label class="text-sm text-gray-400">Score</label><input type="number" value="${stat.score}" class="score-input w-full bg-gray-700 rounded p-2 text-center" data-type="${type}" data-index="${index}"></div>`;
                formContainer.appendChild(formDiv);
            });
        }

        async function addPlayer() {
            const input = document.getElementById('new-player-name');
            const name = input.value.trim();
            if (name && !tournamentData.individualTournament.standings.some(p => p.player === name)) {
                tournamentData.individualTournament.standings.push({ player: name, score: 0 });
                await setDoc(tournamentDocRef, tournamentData);
                input.value = '';
            }
        }

        async function addTeam() {
            const input = document.getElementById('new-team-name');
            const name = input.value.trim();
            if (name && !tournamentData.teamTournament.standings.some(t => t.name === name)) {
                tournamentData.teamTournament.standings.push({ name: name, score: 0 });
                await setDoc(tournamentDocRef, tournamentData);
                input.value = '';
            }
        }

        async function removeParticipant(type, name) {
            if (type === 'individual') {
                tournamentData.individualTournament.standings = tournamentData.individualTournament.standings.filter(p => p.player !== name);
            } else {
                tournamentData.teamTournament.standings = tournamentData.teamTournament.standings.filter(t => t.name !== name);
            }
            await setDoc(tournamentDocRef, tournamentData);
        }

        async function updateAndSave() {
            document.querySelectorAll('.score-input').forEach(input => {
                const { type, index } = input.dataset;
                tournamentData[`${type}Tournament`].standings[index].score = parseInt(input.value) || 0;
            });
            await setDoc(tournamentDocRef, tournamentData);
            saveConfirm.classList.remove('opacity-0');
            setTimeout(() => saveConfirm.classList.add('opacity-0'), 2000);
        }

        async function resetData() {
            if (window.confirm("Are you sure you want to reset ALL tournament data (scores and participants)? This will affect everyone.")) {
                await setDoc(tournamentDocRef, initialTournamentData);
                isAdminAuthenticated = false;
                switchTab('team-standings');
            }
        }

        function switchTab(tabId) {
            tabButtons.forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
            Object.values(contentPanels).forEach(panel => panel.classList.add('hidden'));
            contentPanels[tabId].classList.remove('hidden');
        }

        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                const tabId = button.dataset.tab;
                if (tabId === 'admin-panel') {
                    if (!isAdminAuthenticated) {
                        passwordModal.classList.remove('hidden');
                        passwordInput.focus();
                    } else {
                        switchTab(tabId);
                    }
                } else {
                    switchTab(tabId);
                }
            });
        });

        passwordSubmit.addEventListener('click', () => {
            if (passwordInput.value === ADMIN_PASSWORD) {
                isAdminAuthenticated = true;
                passwordModal.classList.add('hidden');
                passwordInput.value = '';
                passwordError.classList.add('hidden');
                switchTab('admin-panel');
            } else {
                passwordError.classList.remove('hidden');
                passwordInput.value = '';
            }
        });
        
        passwordInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') passwordSubmit.click();
        });

        passwordCancel.addEventListener('click', () => {
            passwordModal.classList.add('hidden');
            passwordInput.value = '';
            passwordError.classList.add('hidden');
        });

        updateButton.addEventListener('click', updateAndSave);
        resetButton.addEventListener('click', resetData);

        onSnapshot(tournamentDocRef, (doc) => {
            if (doc.exists() && doc.data().teamTournament) {
                tournamentData = doc.data();
            } else {
                setDoc(tournamentDocRef, initialTournamentData);
                tournamentData = initialTournamentData;
            }
            renderAll();
        });
    </script>
</body>
</html>

